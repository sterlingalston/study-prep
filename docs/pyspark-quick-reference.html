<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PySpark Cheat Sheet - Quick Reference Guide</title>
    <meta name="description" content="Quick reference for essential PySpark functions with examples. Learn data transformations, string manipulation, and more in the cheat sheet.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8fafc;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            gap: 2rem;
        }
        
        .sidebar {
            width: 300px;
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            position: sticky;
            top: 2rem;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .sidebar h3 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        
        .sidebar ul {
            list-style: none;
        }
        
        .sidebar > ul > li {
            margin-bottom: 1rem;
        }
        
        .sidebar > ul > li > a {
            font-weight: 600;
            color: #4a5568;
            text-decoration: none;
            display: block;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .sidebar > ul > li > a:hover {
            color: #667eea;
        }
        
        .sidebar ul ul {
            margin: 0.5rem 0 0 1rem;
        }
        
        .sidebar ul ul li {
            margin-bottom: 0.3rem;
        }
        
        .sidebar ul ul a {
            color: #718096;
            text-decoration: none;
            font-size: 0.9rem;
            display: block;
            padding: 0.2rem 0;
        }
        
        .sidebar ul ul a:hover {
            color: #667eea;
        }
        
        .content {
            flex: 1;
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .content h2 {
            color: #2d3748;
            margin: 2rem 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #667eea;
            font-size: 1.8rem;
        }
        
        .content h3 {
            color: #4a5568;
            margin: 1.5rem 0 0.8rem 0;
            font-size: 1.3rem;
        }
        
        .content p {
            margin-bottom: 1rem;
            color: #4a5568;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
            overflow-x: auto;
            position: relative;
            border-left: 4px solid #667eea;
        }
        
        .code-block code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .copy-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: #667eea;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            opacity: 0.8;
            transition: opacity 0.3s;
        }
        
        .copy-btn:hover {
            opacity: 1;
        }
        
        .copy-btn.copied {
            background: #48bb78;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 1rem 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background: #f7fafc;
            font-weight: 600;
            color: #2d3748;
        }
        
        td code {
            background: #f1f5f9;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
            color: #667eea;
        }
        
        .highlight {
            background: #fff5f5;
            border-left: 4px solid #f56565;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }
        
        .note {
            background: #f0fff4;
            border-left: 4px solid #48bb78;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }
        
        .warning {
            background: #fffaf0;
            border-left: 4px solid #ed8936;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                position: static;
                max-height: none;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 1rem;
            }
        }
        
        /* Syntax highlighting */
        .token.comment { color: #8b949e; }
        .token.keyword { color: #ff7b72; }
        .token.string { color: #a5d6ff; }
        .token.number { color: #79c0ff; }
        .token.function { color: #d2a8ff; }
        .token.operator { color: #ff7b72; }
        .token.punctuation { color: #e6edf3; }
        .token.builtin { color: #ffa657; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>PySpark Cheat Sheet</h1>
            <p>Quick Reference for Beginners & Pros</p>
        </header>
        
        <div class="main-content">
            <aside class="sidebar">
                <h3>Table of Contents</h3>
                <ul>
                    <li><a href="#create-dataframe">1. Create DataFrame</a>
                        <ul>
                            <li><a href="#with-default-schema">1.1. With Default Schema</a></li>
                            <li><a href="#explicit-schema">1.2. Explicit Schema</a></li>
                            <li><a href="#using-a-list-of-dictionaries">1.3. Using a List of Dictionaries</a></li>
                        </ul>
                    </li>
                    <li><a href="#reading-files">2. Reading Files</a>
                        <ul>
                            <li><a href="#csv-files">2.1. CSV Files</a></li>
                            <li><a href="#json-files">2.2. JSON Files</a></li>
                        </ul>
                    </li>
                    <li><a href="#select-drop-rename-columns">3. Select, Drop, Rename Columns</a>
                        <ul>
                            <li><a href="#selecting-columns">3.1. Selecting Columns</a></li>
                            <li><a href="#renaming-columns">3.2. Renaming Columns</a></li>
                            <li><a href="#adding-columns">3.3. Adding Columns</a></li>
                            <li><a href="#dropping-columns">3.4. Dropping Columns</a></li>
                        </ul>
                    </li>
                    <li><a href="#filtering">4. Filtering</a>
                        <ul>
                            <li><a href="#basic-filtering">4.1. Basic Filtering</a></li>
                            <li><a href="#filter-with-multiple-conditions">4.2. Filter with Multiple Conditions</a></li>
                            <li><a href="#string-filters">4.3. String Filters</a></li>
                            <li><a href="#null-filters">4.4. Null Filters</a></li>
                            <li><a href="#filter-from-a-list">4.5. Filter from a List</a></li>
                        </ul>
                    </li>
                    <li><a href="#grouping">5. Grouping</a>
                        <ul>
                            <li><a href="#basic-aggregations-without-grouping">5.1. Basic Aggregations without Grouping</a></li>
                            <li><a href="#aggregations-with-grouping">5.2. Aggregations with Grouping</a></li>
                            <li><a href="#common-aggregation-functions">5.3. Common Aggregation Functions</a></li>
                        </ul>
                    </li>
                    <li><a href="#joins">6. Joins</a>
                        <ul>
                            <li><a href="#join-types">6.1. Join Types</a></li>
                            <li><a href="#basic-syntax">6.2. Basic Syntax</a></li>
                        </ul>
                    </li>
                    <li><a href="#date-and-time-functions">7. Date and Time Functions</a></li>
                    <li><a href="#math-functions">8. Math Functions</a></li>
                    <li><a href="#string-functions">9. String Functions</a></li>
                    <li><a href="#window-functions">10. Window Functions</a></li>
                    <li><a href="#running-sql-queries">11. Running SQL Queries</a></li>
                </ul>
            </aside>
            
            <main class="content">
                <div class="warning">
                    <p><strong>Welcome to the PySpark Syntax Cheat Sheet!</strong> This page is designed to provide a quick reference to essential PySpark functions and operations. Click the links on the left to quickly navigate through the sections.</p>
                </div>
                
                <h2 id="create-dataframe">Create DataFrame</h2>
                
                <h3 id="with-default-schema">With Default Schema</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql <span class="token keyword">import</span> SparkSession

spark <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">"Example"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>

data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
df <span class="token operator">=</span> spark<span class="token punctuation">.</span>createDataFrame<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></code>
                </div>
                
                <h3 id="explicit-schema">Explicit Schema</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>types <span class="token keyword">import</span> StructType<span class="token punctuation">,</span> StructField<span class="token punctuation">,</span> IntegerType<span class="token punctuation">,</span> StringType

schema <span class="token operator">=</span> StructType<span class="token punctuation">[</span>
    StructField<span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> IntegerType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    StructField<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> StringType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    StructField<span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> IntegerType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">True</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>

df <span class="token operator">=</span> spark<span class="token punctuation">.</span>createDataFrame<span class="token punctuation">(</span>data<span class="token punctuation">,</span> schema<span class="token punctuation">)</span>

<span class="token comment"># Schema as a string</span>
schema <span class="token operator">=</span> <span class="token string">"id INT, name STRING, age INT"</span>
df <span class="token operator">=</span> spark<span class="token punctuation">.</span>createDataFrame<span class="token punctuation">(</span>data<span class="token punctuation">,</span> schema<span class="token operator">=</span>schema<span class="token punctuation">)</span></pre></code>
                </div>
                
                <h3 id="using-a-list-of-dictionaries">Using a List of Dictionaries</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre>data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">:</span> <span class="token number">29</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>

df <span class="token operator">=</span> spark<span class="token punctuation">.</span>createDataFrame<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></code>
                </div>
                
                <h2 id="reading-files">Reading Files</h2>
                
                <h3 id="csv-files">CSV Files</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token comment"># Basic CSV files</span>
df <span class="token operator">=</span> spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"csv"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">"/path/to/sample.csv"</span><span class="token punctuation">)</span>

<span class="token comment"># CSV with header</span>
df <span class="token operator">=</span> spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"header"</span><span class="token punctuation">,</span><span class="token builtin">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>csv<span class="token punctuation">(</span><span class="token string">"/path/to/sample.csv"</span><span class="token punctuation">)</span>

<span class="token comment"># Multiple options</span>
df <span class="token operator">=</span> spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"inferSchema"</span><span class="token punctuation">,</span><span class="token builtin">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"delimiter"</span><span class="token punctuation">,</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">.</span>csv<span class="token punctuation">(</span><span class="token string">"/path/to/sample.csv"</span><span class="token punctuation">)</span></pre></code>
                </div>
                
                <h3 id="json-files">JSON Files</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token comment"># Basic JSON file</span>
df <span class="token operator">=</span> spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"json"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">"/path/to/sample.json"</span><span class="token punctuation">)</span>

<span class="token comment"># JSON with multi-line records</span>
df <span class="token operator">=</span> spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"multiline"</span><span class="token punctuation">,</span> <span class="token builtin">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token string">"/path/to/sample.json"</span><span class="token punctuation">)</span></pre></code>
                </div>
                
                <h2 id="select-drop-rename-columns">Select, Drop, Rename Columns</h2>
                
                <h3 id="selecting-columns">Selecting Columns</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token comment"># Select single column</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span>

<span class="token comment"># Select multiple columns</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">)</span>

<span class="token comment"># Select columns dynamically</span>
columns_to_select <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"department"</span><span class="token punctuation">]</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token operator">*</span>columns_to_select<span class="token punctuation">)</span></pre></code>
                </div>
                
                <h3 id="renaming-columns">Renaming Columns</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token comment"># Rename a column</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>withColumnRenamed<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"full_name"</span><span class="token punctuation">)</span>

<span class="token comment"># Rename multiple columns with chained calls</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>withColumnRenamed<span class="token punctuation">(</span><span class="token string">"old_col1"</span><span class="token punctuation">,</span> <span class="token string">"new_col1"</span><span class="token punctuation">)</span>\
       <span class="token punctuation">.</span>withColumnRenamed<span class="token punctuation">(</span><span class="token string">"old_col2"</span><span class="token punctuation">,</span> <span class="token string">"new_col2"</span><span class="token punctuation">)</span></pre></code>
                </div>
                
                <h3 id="adding-columns">Adding Columns</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>functions <span class="token keyword">import</span> col<span class="token punctuation">,</span> lit<span class="token punctuation">,</span> expr<span class="token punctuation">,</span> when

<span class="token comment"># Add a new column with a constant value</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"country"</span><span class="token punctuation">,</span> lit<span class="token punctuation">(</span><span class="token string">"USA"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Add a new column with a calculated value</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"salary_after_bonus"</span><span class="token punctuation">,</span> col<span class="token punctuation">(</span><span class="token string">"salary"</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.1</span><span class="token punctuation">)</span>

<span class="token comment"># Add a column with conditional logic</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"high_earner"</span><span class="token punctuation">,</span> when<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"salary"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">55000</span><span class="token punctuation">,</span> <span class="token string">"Yes"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>otherwise<span class="token punctuation">(</span><span class="token string">"No"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></code>
                </div>
                
                <h3 id="dropping-columns">Dropping Columns</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token comment"># Drop a column</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">"department"</span><span class="token punctuation">)</span>

<span class="token comment"># Drop multiple columns</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'column1'</span><span class="token punctuation">,</span> <span class="token string">'column2'</span><span class="token punctuation">,</span> <span class="token string">'column3'</span><span class="token punctuation">)</span></pre></code>
                </div>
                
                <h2 id="filtering">Filtering</h2>
                
                <div class="note">
                    <p><strong>Note:</strong> You can refer to columns using any of these notations: <code>df.age</code>, <code>df['age']</code>, <code>col('age')</code></p>
                </div>
                
                <h3 id="basic-filtering">Basic Filtering</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token comment"># Filter on >, <, >=, <=, == condition</span>
df_filtered <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>age <span class="token operator">></span> <span class="token number">30</span><span class="token punctuation">)</span>
df_filtered <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">30</span><span class="token punctuation">)</span>

<span class="token comment"># Using col() function</span>
<span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>functions <span class="token keyword">import</span> col
df_filtered <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">30</span><span class="token punctuation">)</span></pre></code>
                </div>
                
                <h3 id="filter-with-multiple-conditions">Filter with Multiple Conditions</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token comment"># Multiple conditions require parentheses around each condition</span>

<span class="token comment"># AND condition ( & )</span>
df_filtered <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>age <span class="token operator">></span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">&</span> <span class="token punctuation">(</span>df<span class="token punctuation">.</span>department <span class="token operator">==</span> <span class="token string">"Engineering"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># OR condition ( | )</span>
df_filtered <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>age <span class="token operator"><</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>df<span class="token punctuation">.</span>department <span class="token operator">==</span> <span class="token string">"Finance"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></code>
                </div>
                
                <h3 id="string-filters">String Filters</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token comment"># Filter rows where department equals 'Marketing'</span>
df_filtered <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>department <span class="token operator">==</span> <span class="token string">"Marketing"</span><span class="token punctuation">)</span>

<span class="token comment"># Contains a substring</span>
df_filtered <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"department"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">"Engineer"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Filter rows where the name starts with 'A'</span>
df<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></code>
                </div>
                
                <h2 id="grouping">Grouping</h2>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>functions <span class="token keyword">import</span> count<span class="token punctuation">,</span> <span class="token builtin">sum</span><span class="token punctuation">,</span> avg<span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">,</span> <span class="token builtin">max</span></pre></code>
                </div>
                
                <h3 id="basic-aggregations-without-grouping">Basic Aggregations without Grouping</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token comment"># Count rows</span>
df<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Sum</span>
df<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token string">"Salary"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Multiple Aggregations</span>
df<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token string">"Salary"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token string">"Salary"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></code>
                </div>

                <h3 id="aggregations-with-grouping">Aggregations with Grouping</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token comment"># Group by a single column</span>
df<span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span><span class="token string">"Department"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token string">"Salary"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Group by with multiple aggregations</span>
df<span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span><span class="token string">"Department"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span>
    count<span class="token punctuation">(</span><span class="token string">"Employee"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>alias<span class="token punctuation">(</span><span class="token string">"Employee_Count"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    avg<span class="token punctuation">(</span><span class="token string">"Salary"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>alias<span class="token punctuation">(</span><span class="token string">"Average_Salary"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></pre></code>
                </div>
                
                <h2 id="joins">Joins</h2>
                
                <h3 id="join-types">Join Types</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Join Type</th>
                                <th>Syntax</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>inner</strong></td>
                                <td><code>how="inner"</code></td>
                                <td>Returns matching rows from both DataFrames</td>
                            </tr>
                            <tr>
                                <td><strong>outer</strong> (full)</td>
                                <td><code>how="outer"</code></td>
                                <td>Returns all rows, with NULL where no match is found</td>
                            </tr>
                            <tr>
                                <td><strong>left</strong></td>
                                <td><code>how="left"</code></td>
                                <td>Returns all rows from the left DataFrame</td>
                            </tr>
                            <tr>
                                <td><strong>right</strong></td>
                                <td><code>how="right"</code></td>
                                <td>Returns all rows from the right DataFrame</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h3 id="basic-syntax">Basic Join Syntax</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token comment"># Basic Join</span>
df1<span class="token punctuation">.</span>join<span class="token punctuation">(</span>df2<span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">"inner"</span><span class="token punctuation">)</span>

<span class="token comment"># Join on Multiple Columns</span>
df1<span class="token punctuation">.</span>join<span class="token punctuation">(</span>df2<span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"col1"</span><span class="token punctuation">,</span> <span class="token string">"col2"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">"left"</span><span class="token punctuation">)</span>

<span class="token comment"># Conditional Join</span>
df1<span class="token punctuation">.</span>join<span class="token punctuation">(</span>df2<span class="token punctuation">,</span> <span class="token punctuation">(</span>df1<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> df2<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span> <span class="token operator">&</span> <span class="token punctuation">(</span>df2<span class="token punctuation">.</span>city <span class="token operator">==</span> <span class="token string">"New York"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">"inner"</span><span class="token punctuation">)</span></pre></code>
                </div>
                
                <h2 id="date-and-time-functions">Date and Time Functions</h2>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>functions <span class="token keyword">import</span> to_date<span class="token punctuation">,</span> date_format<span class="token punctuation">,</span> current_date

<span class="token comment"># Convert string to date</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"date_parsed"</span><span class="token punctuation">,</span> to_date<span class="token punctuation">(</span><span class="token string">"date_str"</span><span class="token punctuation">,</span> <span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Format date</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"formatted_date"</span><span class="token punctuation">,</span> date_format<span class="token punctuation">(</span><span class="token string">"date"</span><span class="token punctuation">,</span> <span class="token string">"dd-MMM-yyyy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Current date</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"current_date"</span><span class="token punctuation">,</span> current_date<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></code>
                </div>
                
                <h2 id="string-functions">String Functions</h2>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>functions <span class="token keyword">import</span> concat<span class="token punctuation">,</span> upper<span class="token punctuation">,</span> lower<span class="token punctuation">,</span> trim<span class="token punctuation">,</span> split

<span class="token comment"># Concatenate strings</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"full_name"</span><span class="token punctuation">,</span> concat<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"first_name"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lit<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token punctuation">(</span><span class="token string">"last_name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Convert to uppercase/lowercase</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"upper_name"</span><span class="token punctuation">,</span> upper<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"lower_name"</span><span class="token punctuation">,</span> lower<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Split strings</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"name_parts"</span><span class="token punctuation">,</span> split<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"full_name"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></code>
                </div>
                
                <h2 id="window-functions">Window Functions</h2>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>window <span class="token keyword">import</span> Window
<span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>functions <span class="token keyword">import</span> row_number<span class="token punctuation">,</span> rank<span class="token punctuation">,</span> lag<span class="token punctuation">,</span> lead

<span class="token comment"># Define window specification</span>
window_spec <span class="token operator">=</span> Window<span class="token punctuation">.</span>partitionBy<span class="token punctuation">(</span><span class="token string">"department"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>orderBy<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"salary"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>desc<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Apply window functions</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"row_number"</span><span class="token punctuation">,</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>over<span class="token punctuation">(</span>window_spec<span class="token punctuation">)</span><span class="token punctuation">)</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"rank"</span><span class="token punctuation">,</span> rank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>over<span class="token punctuation">(</span>window_spec<span class="token punctuation">)</span><span class="token punctuation">)</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"previous_salary"</span><span class="token punctuation">,</span> lag<span class="token punctuation">(</span><span class="token string">"salary"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>over<span class="token punctuation">(</span>window_spec<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></code>
                </div>
                
                <h2 id="running-sql-queries">Running SQL Queries</h2>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code><pre><span class="token comment"># Create a temporary SQL table from a DataFrame</span>
df<span class="token punctuation">.</span>createOrReplaceTempView<span class="token punctuation">(</span><span class="token string">"employees"</span><span class="token punctuation">)</span>

<span class="token comment"># Run SQL queries</span>
df_sql <span class="token operator">=</span> spark<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">"SELECT * FROM employees WHERE salary > 50000"</span><span class="token punctuation">)</span>

<span class="token comment"># Aggregations with SQL</span>
df_sql <span class="token operator">=</span> spark<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">"SELECT department, AVG(salary) AS avg_salary FROM employees GROUP BY department"</span><span class="token punctuation">)</span>

<span class="token comment"># Using CASE WHEN</span>
df_sql <span class="token operator">=</span> spark<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">"""
    SELECT name, salary,
    CASE 
        WHEN salary > 50000 THEN 'High'
        ELSE 'Low'
    END AS salary_category
    FROM employees
"""</span><span class="token punctuation">)</span></pre></code>
                </div>
                
            </main>
        </div>
    </div>
    
    <script>
        function copyCode(button) {
            // Find the code block within the same parent
            const codeBlock = button.parentElement.querySelector('code pre');
            
            if (!codeBlock) {
                console.error('Code block not found');
                return;
            }
            
            // Get the text content, removing HTML tags
            let codeText = codeBlock.textContent || codeBlock.innerText;
            
            // Use the modern Clipboard API if available
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(codeText).then(() => {
                    showCopySuccess(button);
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                    fallbackCopyTextToClipboard(codeText, button);
                });
            } else {
                // Fallback for older browsers or non-HTTPS contexts
                fallbackCopyTextToClipboard(codeText, button);
            }
        }
        
        function fallbackCopyTextToClipboard(text, button) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            
            // Avoid scrolling to bottom
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";
            textArea.style.opacity = "0";
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopySuccess(button);
                } else {
                    console.error('Fallback: Oops, unable to copy');
                }
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
            }
            
            document.body.removeChild(textArea);
        }
        
        function showCopySuccess(button) {
            const originalText = button.textContent;
            button.textContent = 'Copied!';
            button.classList.add('copied');
            
            setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('copied');
            }, 2000);
        }
        
        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
</body>
</html>